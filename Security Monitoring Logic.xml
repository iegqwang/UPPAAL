<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.1//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_1.dtd'>
<nta>
	<declaration>// Place global declarations here.
int Category; //1 gateway, 2 sensor, 3 actuator
int ExceptionLevel; //0 no fault, 1 fault-tolerant mechanism, 2 manual intervention 
int KMSType; //1 update, 2 verify
bool GatewayStatus, TerminalStatus;
bool SubmitData;
int AlreadyPolling;
int KeyVerificationFlag;

chan StartIDS, FinishIDS; 
urgent chan StartAC, FinishAC; 
urgent chan StartKMS, FinishKMS; 
urgent chan HandlingException, Return; 
chan StartMiddle, FinishMiddle; 
urgent chan Decryption, DReturn;
urgent chan Encryption, EReturn;

clock c;</declaration>
	<template>
		<name x="5" y="5">Top</name>
		<declaration>// Place local declarations here.
</declaration>
		<location id="id0" x="-584" y="-400">
			<name x="-624" y="-432">DataAnalysis</name>
		</location>
		<location id="id1" x="-728" y="-400">
			<name x="-784" y="-416">Record</name>
			<label kind="invariant" x="-784" y="-400">c&lt;=600</label>
		</location>
		<location id="id2" x="-464" y="-400">
			<name x="-488" y="-432">WaitHE</name>
		</location>
		<location id="id3" x="-168" y="-504">
			<name x="-208" y="-536">CheckPolling</name>
		</location>
		<location id="id4" x="-1112" y="-616">
			<name x="-1136" y="-648">Restart</name>
			<label kind="invariant" x="-1136" y="-608">c&lt;=300</label>
		</location>
		<location id="id5" x="-296" y="-504">
			<name x="-328" y="-536">CheckData</name>
		</location>
		<location id="id6" x="-296" y="-400">
			<name x="-280" y="-408">Verify</name>
			<urgent/>
		</location>
		<location id="id7" x="-432" y="-504">
			<name x="-464" y="-536">WaitData</name>
		</location>
		<location id="id8" x="-560" y="-504">
			<name x="-600" y="-536">EnterMiddle</name>
			<committed/>
		</location>
		<location id="id9" x="-952" y="-504">
			<name x="-1000" y="-536">Authentication</name>
		</location>
		<location id="id10" x="-1008" y="-616">
			<name x="-1018" y="-646">Idle</name>
		</location>
		<location id="id11" x="-848" y="-504">
			<name x="-872" y="-536">WaitAC</name>
		</location>
		<location id="id12" x="-872" y="-616">
			<name x="-896" y="-648">WaitIDS</name>
		</location>
		<location id="id13" x="-728" y="-616">
			<name x="-784" y="-648">IntrusionDetection</name>
		</location>
		<location id="id14" x="-728" y="-504">
			<name x="-760" y="-536">CheckGS</name>
		</location>
		<location id="id15" x="-1080" y="-504">
			<name x="-1120" y="-536">Configuration</name>
		</location>
		<location id="id16" x="-1184" y="-504">
			<name x="-1232" y="-512">Start</name>
		</location>
		<init ref="id16"/>
		<transition>
			<source ref="id3"/>
			<target ref="id1"/>
			<label kind="guard" x="-336" y="-360">AlreadyPolling==0</label>
			<label kind="assignment" x="-208" y="-360">c:=0</label>
			<nail x="-168" y="-336"/>
			<nail x="-728" y="-336"/>
		</transition>
		<transition>
			<source ref="id1"/>
			<target ref="id14"/>
			<label kind="guard" x="-752" y="-464">c&gt;=300</label>
		</transition>
		<transition>
			<source ref="id0"/>
			<target ref="id1"/>
			<label kind="assignment" x="-664" y="-416">c:=0</label>
		</transition>
		<transition>
			<source ref="id2"/>
			<target ref="id0"/>
			<label kind="synchronisation" x="-544" y="-416">Return?</label>
		</transition>
		<transition>
			<source ref="id3"/>
			<target ref="id14"/>
			<label kind="guard" x="-504" y="-624">AlreadyPolling==1</label>
			<nail x="-304" y="-600"/>
			<nail x="-608" y="-600"/>
		</transition>
		<transition>
			<source ref="id6"/>
			<target ref="id2"/>
			<label kind="synchronisation" x="-432" y="-416">HandlingException!</label>
		</transition>
		<transition>
			<source ref="id5"/>
			<target ref="id3"/>
			<label kind="guard" x="-272" y="-504">!SubmitData</label>
		</transition>
		<transition>
			<source ref="id5"/>
			<target ref="id6"/>
			<label kind="guard" x="-336" y="-464">SubmitData</label>
		</transition>
		<transition>
			<source ref="id7"/>
			<target ref="id5"/>
			<label kind="synchronisation" x="-408" y="-504">FinishMiddle?</label>
		</transition>
		<transition>
			<source ref="id8"/>
			<target ref="id7"/>
			<label kind="synchronisation" x="-536" y="-504">StartMiddle!</label>
		</transition>
		<transition>
			<source ref="id14"/>
			<target ref="id8"/>
			<label kind="guard" x="-696" y="-504">GatewayStatus</label>
		</transition>
		<transition>
			<source ref="id4"/>
			<target ref="id16"/>
			<label kind="guard" x="-1208" y="-584">c&gt;=180</label>
			<nail x="-1184" y="-616"/>
		</transition>
		<transition>
			<source ref="id10"/>
			<target ref="id4"/>
			<label kind="assignment" x="-1072" y="-632">c:=0</label>
		</transition>
		<transition>
			<source ref="id12"/>
			<target ref="id10"/>
			<label kind="synchronisation" x="-968" y="-632">FinishIDS?</label>
		</transition>
		<transition>
			<source ref="id11"/>
			<target ref="id14"/>
			<label kind="synchronisation" x="-824" y="-504">FinishAC?</label>
		</transition>
		<transition>
			<source ref="id9"/>
			<target ref="id11"/>
			<label kind="synchronisation" x="-928" y="-504">StartAC!</label>
		</transition>
		<transition>
			<source ref="id15"/>
			<target ref="id9"/>
			<label kind="guard" x="-1040" y="-488">c&gt;=90</label>
			<label kind="assignment" x="-1056" y="-504">Category=1</label>
		</transition>
		<transition>
			<source ref="id13"/>
			<target ref="id12"/>
			<label kind="synchronisation" x="-824" y="-632">StartIDS!</label>
		</transition>
		<transition>
			<source ref="id14"/>
			<target ref="id13"/>
			<label kind="guard" x="-784" y="-584">!GatewayStatus</label>
			<label kind="assignment" x="-768" y="-568">Category=1</label>
		</transition>
		<transition>
			<source ref="id16"/>
			<target ref="id15"/>
			<label kind="assignment" x="-1152" y="-504">c:=0</label>
		</transition>
	</template>
	<template>
		<name>Middle</name>
		<declaration>bool PollingSuccess;
clock y;

int ReturnFlag;</declaration>
		<location id="id17" x="-2512" y="-296">
			<name x="-2560" y="-304">Clear_</name>
		</location>
		<location id="id18" x="-1856" y="-384">
			<name x="-1896" y="-416">MonitoringInfo_</name>
		</location>
		<location id="id19" x="-2008" y="-384">
			<name x="-2040" y="-416">CheckRF2</name>
		</location>
		<location id="id20" x="-2168" y="-384">
			<name x="-2200" y="-416">WaitDevice_</name>
			<label kind="invariant" x="-2184" y="-376">y&lt;=5</label>
		</location>
		<location id="id21" x="-2008" y="-256">
			<name x="-1992" y="-264">Failure</name>
		</location>
		<location id="id22" x="-2512" y="-384">
			<name x="-2544" y="-416">CheckRF1</name>
		</location>
		<location id="id23" x="-2368" y="-384">
			<name x="-2384" y="-416">Keep</name>
		</location>
		<location id="id24" x="-2264" y="-384">
			<name x="-2304" y="-416">RetrieveData</name>
		</location>
		<location id="id25" x="-2104" y="-480">
			<name x="-2136" y="-512">UpdateKey_</name>
		</location>
		<location id="id26" x="-2112" y="-632">
			<name x="-2136" y="-664">WaitIDS</name>
		</location>
		<location id="id27" x="-2240" y="-632">
			<name x="-2296" y="-664">IntrusionDetection</name>
		</location>
		<location id="id28" x="-2408" y="-480">
			<name x="-2440" y="-512">CheckTS_</name>
		</location>
		<location id="id29" x="-2664" y="-384">
			<name x="-2696" y="-416">WaitDevice</name>
			<label kind="invariant" x="-2680" y="-376">y&lt;=5</label>
		</location>
		<location id="id30" x="-2760" y="-384">
			<name x="-2808" y="-416">DeviceControl</name>
		</location>
		<location id="id31" x="-2256" y="-480">
			<name x="-2288" y="-512">CheckAP_</name>
		</location>
		<location id="id32" x="-1976" y="-480">
			<name x="-2008" y="-512">WaitKMS_</name>
		</location>
		<location id="id33" x="-2240" y="-800">
			<name x="-2256" y="-832">Clear</name>
		</location>
		<location id="id34" x="-1976" y="-632">
			<name x="-1960" y="-648">End</name>
			<committed/>
		</location>
		<location id="id35" x="-2504" y="-480">
			<name x="-2528" y="-512">WaitAC_</name>
		</location>
		<location id="id36" x="-1976" y="-688">
			<name x="-1960" y="-696">MonitoringInfo</name>
		</location>
		<location id="id37" x="-1976" y="-800">
			<name x="-1960" y="-808">CheckRF</name>
		</location>
		<location id="id38" x="-1976" y="-888">
			<name x="-2008" y="-920">WaitNode</name>
			<label kind="invariant" x="-1960" y="-904">y&lt;=60</label>
		</location>
		<location id="id39" x="-2504" y="-632">
			<name x="-2528" y="-664">WaitAC</name>
		</location>
		<location id="id40" x="-2752" y="-552">
			<name x="-2792" y="-584">CheckCategory</name>
		</location>
		<location id="id41" x="-2680" y="-480">
			<name x="-2736" y="-512">ReadConInfo</name>
		</location>
		<location id="id42" x="-2592" y="-480">
			<name x="-2640" y="-512">Authentication_</name>
		</location>
		<location id="id43" x="-2104" y="-888">
			<name x="-2152" y="-920">SelfMonitoring</name>
		</location>
		<location id="id44" x="-2240" y="-888">
			<name x="-2272" y="-920">WaitKMS</name>
		</location>
		<location id="id45" x="-2408" y="-720">
			<name x="-2496" y="-728">ReadCache</name>
		</location>
		<location id="id46" x="-2408" y="-632">
			<name x="-2440" y="-664">CheckTS</name>
		</location>
		<location id="id47" x="-2408" y="-888">
			<name x="-2448" y="-920">UpdateKey</name>
		</location>
		<location id="id48" x="-2408" y="-800">
			<name x="-2480" y="-816">CheckAP</name>
		</location>
		<location id="id49" x="-2592" y="-632">
			<name x="-2632" y="-664">Authentication</name>
		</location>
		<location id="id50" x="-2680" y="-632">
			<name x="-2704" y="-664">Connect</name>
		</location>
		<location id="id51" x="-2896" y="-552">
			<name x="-2936" y="-560">Idle</name>
		</location>
		<init ref="id51"/>
		<transition>
			<source ref="id18"/>
			<target ref="id34"/>
			<nail x="-1856" y="-552"/>
		</transition>
		<transition>
			<source ref="id19"/>
			<target ref="id18"/>
			<label kind="guard" x="-1984" y="-400">ReturnFlag==1</label>
			<label kind="assignment" x="-1992" y="-384">SubmitData=true,
PollingSuccess=true</label>
		</transition>
		<transition>
			<source ref="id21"/>
			<target ref="id51"/>
			<label kind="synchronisation" x="-2880" y="-272">FinishMiddle!</label>
			<label kind="assignment" x="-2760" y="-272">PollingSuccess=false</label>
			<nail x="-2896" y="-256"/>
		</transition>
		<transition>
			<source ref="id17"/>
			<target ref="id21"/>
			<nail x="-2056" y="-296"/>
		</transition>
		<transition>
			<source ref="id19"/>
			<target ref="id21"/>
			<label kind="guard" x="-2064" y="-328">ReturnFlag==0</label>
		</transition>
		<transition>
			<source ref="id22"/>
			<target ref="id17"/>
			<label kind="guard" x="-2560" y="-336">ReturnFlag==0</label>
		</transition>
		<transition>
			<source ref="id20"/>
			<target ref="id19"/>
			<label kind="select" x="-2120" y="-384">rf2:int[0,1]</label>
			<label kind="assignment" x="-2136" y="-368">ReturnFlag=rf2</label>
		</transition>
		<transition>
			<source ref="id24"/>
			<target ref="id20"/>
			<label kind="assignment" x="-2232" y="-384">y:=0</label>
		</transition>
		<transition>
			<source ref="id23"/>
			<target ref="id24"/>
			<label kind="guard" x="-2336" y="-384">y&gt;=30</label>
		</transition>
		<transition>
			<source ref="id22"/>
			<target ref="id23"/>
			<label kind="guard" x="-2488" y="-384">ReturnFlag==1</label>
		</transition>
		<transition>
			<source ref="id29"/>
			<target ref="id22"/>
			<label kind="select" x="-2616" y="-384">rf1:int[0,1]</label>
			<label kind="assignment" x="-2632" y="-368">ReturnFlag=rf1</label>
		</transition>
		<transition>
			<source ref="id31"/>
			<target ref="id34"/>
			<label kind="guard" x="-2240" y="-552">AlreadyPolling==1</label>
			<nail x="-2256" y="-536"/>
			<nail x="-2024" y="-536"/>
		</transition>
		<transition>
			<source ref="id28"/>
			<target ref="id34"/>
			<label kind="guard" x="-2392" y="-600">!TerminalStatus</label>
			<label kind="assignment" x="-2392" y="-584">ExceptionLevel=2</label>
			<nail x="-2408" y="-584"/>
			<nail x="-2040" y="-584"/>
		</transition>
		<transition>
			<source ref="id30"/>
			<target ref="id29"/>
			<label kind="assignment" x="-2728" y="-384">y:=0</label>
		</transition>
		<transition>
			<source ref="id32"/>
			<target ref="id30"/>
			<label kind="synchronisation" x="-2000" y="-448">FinishKMS?</label>
			<nail x="-1920" y="-480"/>
			<nail x="-1920" y="-432"/>
			<nail x="-2824" y="-432"/>
			<nail x="-2824" y="-384"/>
		</transition>
		<transition>
			<source ref="id25"/>
			<target ref="id32"/>
			<label kind="synchronisation" x="-2072" y="-480">StartKMS!</label>
		</transition>
		<transition>
			<source ref="id31"/>
			<target ref="id25"/>
			<label kind="guard" x="-2240" y="-480">AlreadyPolling==0</label>
			<label kind="assignment" x="-2224" y="-464">KMSType=1</label>
		</transition>
		<transition>
			<source ref="id28"/>
			<target ref="id31"/>
			<label kind="select" x="-2368" y="-480">ap_:int[0,1]</label>
			<label kind="guard" x="-2384" y="-496">TerminalStatus</label>
			<label kind="assignment" x="-2392" y="-464">AlreadyPolling=ap_</label>
		</transition>
		<transition>
			<source ref="id35"/>
			<target ref="id28"/>
			<label kind="synchronisation" x="-2488" y="-480">FinishAC?</label>
		</transition>
		<transition>
			<source ref="id42"/>
			<target ref="id35"/>
			<label kind="synchronisation" x="-2576" y="-480">StartAC!</label>
		</transition>
		<transition>
			<source ref="id33"/>
			<target ref="id27"/>
		</transition>
		<transition>
			<source ref="id26"/>
			<target ref="id34"/>
			<label kind="synchronisation" x="-2080" y="-632">FinishIDS?</label>
		</transition>
		<transition>
			<source ref="id27"/>
			<target ref="id26"/>
			<label kind="synchronisation" x="-2208" y="-632">StartIDS!</label>
		</transition>
		<transition>
			<source ref="id46"/>
			<target ref="id27"/>
			<label kind="guard" x="-2376" y="-648">!TerminalStatus</label>
			<label kind="assignment" x="-2384" y="-632">AlreadyPolling=0</label>
		</transition>
		<transition>
			<source ref="id48"/>
			<target ref="id51"/>
			<label kind="guard" x="-2760" y="-816">AlreadyPolling==1</label>
			<label kind="synchronisation" x="-2744" y="-800">FinishMiddle!</label>
			<nail x="-2776" y="-800"/>
		</transition>
		<transition>
			<source ref="id37"/>
			<target ref="id33"/>
			<label kind="guard" x="-2160" y="-824">ReturnFlag==0</label>
			<label kind="assignment" x="-2168" y="-800">PollingSuccess=false</label>
		</transition>
		<transition>
			<source ref="id34"/>
			<target ref="id51"/>
			<label kind="synchronisation" x="-2864" y="-936">FinishMiddle!</label>
			<nail x="-1848" y="-632"/>
			<nail x="-1848" y="-936"/>
			<nail x="-2896" y="-936"/>
		</transition>
		<transition>
			<source ref="id36"/>
			<target ref="id34"/>
		</transition>
		<transition>
			<source ref="id37"/>
			<target ref="id36"/>
			<label kind="guard" x="-2024" y="-768">ReturnFlag==1</label>
			<label kind="assignment" x="-2032" y="-752">SubmitData=true,
PollingSuccess=true</label>
		</transition>
		<transition>
			<source ref="id38"/>
			<target ref="id37"/>
			<label kind="select" x="-2000" y="-864">rf:int[0,1]</label>
			<label kind="assignment" x="-2016" y="-848">ReturnFlag=rf</label>
		</transition>
		<transition>
			<source ref="id43"/>
			<target ref="id38"/>
			<label kind="assignment" x="-2056" y="-904">y:=0</label>
		</transition>
		<transition>
			<source ref="id41"/>
			<target ref="id42"/>
		</transition>
		<transition>
			<source ref="id44"/>
			<target ref="id43"/>
			<label kind="synchronisation" x="-2208" y="-904">FinishKMS?</label>
		</transition>
		<transition>
			<source ref="id47"/>
			<target ref="id44"/>
			<label kind="synchronisation" x="-2352" y="-904">StartKMS!</label>
		</transition>
		<transition>
			<source ref="id48"/>
			<target ref="id47"/>
			<label kind="guard" x="-2464" y="-864">AlreadyPolling==0</label>
			<label kind="assignment" x="-2440" y="-848">KMSType=1</label>
		</transition>
		<transition>
			<source ref="id45"/>
			<target ref="id48"/>
			<label kind="select" x="-2440" y="-776">ap:int[0,1]</label>
			<label kind="assignment" x="-2464" y="-760">AlreadyPolling=ap</label>
		</transition>
		<transition>
			<source ref="id46"/>
			<target ref="id45"/>
			<label kind="guard" x="-2456" y="-688">TerminalStatus</label>
		</transition>
		<transition>
			<source ref="id39"/>
			<target ref="id46"/>
			<label kind="synchronisation" x="-2488" y="-632">FinishAC?</label>
		</transition>
		<transition>
			<source ref="id49"/>
			<target ref="id39"/>
			<label kind="synchronisation" x="-2576" y="-632">StartAC!</label>
		</transition>
		<transition>
			<source ref="id50"/>
			<target ref="id49"/>
		</transition>
		<transition>
			<source ref="id40"/>
			<target ref="id41"/>
			<label kind="guard" x="-2792" y="-480">Category==3</label>
			<nail x="-2752" y="-480"/>
		</transition>
		<transition>
			<source ref="id40"/>
			<target ref="id50"/>
			<label kind="guard" x="-2792" y="-648">Category==2</label>
			<nail x="-2752" y="-632"/>
		</transition>
		<transition>
			<source ref="id51"/>
			<target ref="id40"/>
			<label kind="select" x="-2856" y="-552">dc:int[2,3]</label>
			<label kind="synchronisation" x="-2864" y="-568">StartMiddle?</label>
			<label kind="assignment" x="-2872" y="-536">Category=dc, 
SubmitData=false</label>
		</transition>
	</template>
	<template>
		<name>KMS</name>
		<declaration>int KeyUpdateFlag;
</declaration>
		<location id="id52" x="-544" y="-320">
			<name x="-584" y="-352">LogRecord</name>
		</location>
		<location id="id53" x="-744" y="-320">
			<name x="-808" y="-352">CompareToCenterInfo</name>
		</location>
		<location id="id54" x="-904" y="-320">
			<name x="-944" y="-352">DecryptionInfo</name>
		</location>
		<location id="id55" x="-240" y="-384">
			<name x="-248" y="-416">End</name>
			<committed/>
		</location>
		<location id="id56" x="-728" y="-440">
			<name x="-760" y="-472">CheckKUF</name>
		</location>
		<location id="id57" x="-440" y="-440">
			<name x="-464" y="-472">NewKey</name>
		</location>
		<location id="id58" x="-336" y="-440">
			<name x="-368" y="-472">Transmit</name>
		</location>
		<location id="id59" x="-560" y="-440">
			<name x="-608" y="-472">KeyPoolAssign</name>
		</location>
		<location id="id60" x="-904" y="-440">
			<name x="-936" y="-472">DeviceKey</name>
		</location>
		<location id="id61" x="-1032" y="-320">
			<name x="-1080" y="-352">GetCiphertext</name>
		</location>
		<location id="id62" x="-1032" y="-440">
			<name x="-1080" y="-472">Communication</name>
		</location>
		<location id="id63" x="-1136" y="-376">
			<name x="-1168" y="-408">CheckKT</name>
		</location>
		<location id="id64" x="-1256" y="-376">
			<name x="-1266" y="-406">Idle</name>
		</location>
		<init ref="id64"/>
		<transition>
			<source ref="id52"/>
			<target ref="id55"/>
			<nail x="-240" y="-320"/>
		</transition>
		<transition>
			<source ref="id53"/>
			<target ref="id52"/>
			<label kind="select" x="-672" y="-304">kvf:int[0,1]</label>
			<label kind="assignment" x="-720" y="-320">KeyVerificationFlag=kvf</label>
		</transition>
		<transition>
			<source ref="id54"/>
			<target ref="id53"/>
			<label kind="synchronisation" x="-856" y="-336">DReturn?</label>
		</transition>
		<transition>
			<source ref="id61"/>
			<target ref="id54"/>
			<label kind="synchronisation" x="-1008" y="-336">Decryption!</label>
		</transition>
		<transition>
			<source ref="id56"/>
			<target ref="id55"/>
			<label kind="guard" x="-704" y="-400">KeyUpdateFlag==0</label>
			<nail x="-728" y="-384"/>
		</transition>
		<transition>
			<source ref="id55"/>
			<target ref="id64"/>
			<label kind="synchronisation" x="-808" y="-536">FinishKMS!</label>
			<nail x="-240" y="-520"/>
			<nail x="-1256" y="-520"/>
		</transition>
		<transition>
			<source ref="id58"/>
			<target ref="id55"/>
		</transition>
		<transition>
			<source ref="id57"/>
			<target ref="id58"/>
			<label kind="synchronisation" x="-416" y="-456">EReturn?</label>
		</transition>
		<transition>
			<source ref="id59"/>
			<target ref="id57"/>
			<label kind="synchronisation" x="-536" y="-456">Encryption!</label>
		</transition>
		<transition>
			<source ref="id56"/>
			<target ref="id59"/>
			<label kind="guard" x="-704" y="-456">KeyUpdateFlag==1</label>
		</transition>
		<transition>
			<source ref="id60"/>
			<target ref="id56"/>
			<label kind="select" x="-848" y="-424">kuf:int[0,1]</label>
			<label kind="synchronisation" x="-848" y="-456">DReturn?</label>
			<label kind="assignment" x="-880" y="-440">KeyUpdateFlag=kuf</label>
		</transition>
		<transition>
			<source ref="id62"/>
			<target ref="id60"/>
			<label kind="synchronisation" x="-1008" y="-456">Decryption!</label>
		</transition>
		<transition>
			<source ref="id63"/>
			<target ref="id61"/>
			<label kind="guard" x="-1144" y="-320">KMSType==2</label>
			<nail x="-1136" y="-320"/>
		</transition>
		<transition>
			<source ref="id63"/>
			<target ref="id62"/>
			<label kind="guard" x="-1144" y="-456">KMSType==1</label>
			<nail x="-1136" y="-440"/>
		</transition>
		<transition>
			<source ref="id64"/>
			<target ref="id63"/>
			<label kind="synchronisation" x="-1232" y="-392">StartKMS?</label>
		</transition>
	</template>
	<template>
		<name>AC</name>
		<declaration>int AuthenticationFlag;</declaration>
		<location id="id65" x="-1408" y="-264">
			<name x="-1480" y="-296">ManualIntervention</name>
		</location>
		<location id="id66" x="-1408" y="-448">
			<name x="-1440" y="-480">CheckAF</name>
		</location>
		<location id="id67" x="-1616" y="-448">
			<name x="-1680" y="-480">SimpleAuthentication_</name>
		</location>
		<location id="id68" x="-928" y="-360">
			<name x="-976" y="-392">FakeMessage</name>
		</location>
		<location id="id69" x="-864" y="-264">
			<name x="-912" y="-296">ObtainMessage</name>
		</location>
		<location id="id70" x="-1072" y="-264">
			<name x="-1128" y="-296">MACEqualOrNot</name>
		</location>
		<location id="id71" x="-1280" y="-360">
			<name x="-1328" y="-392">HashAlgorithm</name>
		</location>
		<location id="id72" x="-1280" y="-264">
			<name x="-1328" y="-296">WaitKeyPacket</name>
		</location>
		<location id="id73" x="-1072" y="-360">
			<name x="-1128" y="-392">CheatingMessage</name>
		</location>
		<location id="id74" x="-1072" y="-552">
			<name x="-1136" y="-584">CrowdingMessage</name>
		</location>
		<location id="id75" x="-1280" y="-456">
			<name x="-1344" y="-488">ComplexAuthentication</name>
		</location>
		<location id="id76" x="-1280" y="-552">
			<name x="-1328" y="-584">CheckPublicKey</name>
		</location>
		<location id="id77" x="-1248" y="-760">
			<name x="-1296" y="-792">AlertToManager</name>
		</location>
		<location id="id78" x="-952" y="-656">
			<name x="-968" y="-688">End</name>
			<committed/>
		</location>
		<location id="id79" x="-1248" y="-656">
			<name x="-1280" y="-688">CheckKVF</name>
		</location>
		<location id="id80" x="-1376" y="-656">
			<name x="-1408" y="-688">WaitKMS</name>
		</location>
		<location id="id81" x="-1496" y="-656">
			<name x="-1544" y="-688">KeyVerification</name>
		</location>
		<location id="id82" x="-1864" y="-552">
			<name x="-1874" y="-582">Idle</name>
		</location>
		<location id="id83" x="-1480" y="-552">
			<name x="-1544" y="-584">SimpleAuthentication</name>
		</location>
		<location id="id84" x="-1744" y="-448">
			<name x="-1792" y="-480">Communication</name>
		</location>
		<location id="id85" x="-1624" y="-656">
			<name x="-1664" y="-688">GatewayCenter</name>
		</location>
		<location id="id86" x="-1624" y="-552">
			<name x="-1672" y="-584">ReceiveMessage</name>
		</location>
		<location id="id87" x="-1744" y="-552">
			<name x="-1792" y="-584">CheckCategory</name>
		</location>
		<init ref="id82"/>
		<transition>
			<source ref="id66"/>
			<target ref="id82"/>
			<label kind="guard" x="-1704" y="-368">AuthenticationFlag==1</label>
			<label kind="synchronisation" x="-1824" y="-416">FinishAC!</label>
			<label kind="assignment" x="-1688" y="-352">TerminalStatus=1</label>
			<nail x="-1464" y="-352"/>
			<nail x="-1776" y="-352"/>
		</transition>
		<transition>
			<source ref="id65"/>
			<target ref="id82"/>
			<label kind="synchronisation" x="-1856" y="-288">FinishAC!</label>
			<label kind="assignment" x="-1688" y="-280">TerminalStatus=0</label>
			<nail x="-1864" y="-264"/>
		</transition>
		<transition>
			<source ref="id66"/>
			<target ref="id65"/>
			<label kind="guard" x="-1504" y="-328">AuthenticationFlag==0</label>
		</transition>
		<transition>
			<source ref="id67"/>
			<target ref="id66"/>
			<label kind="select" x="-1552" y="-464">af4:int[0,1]</label>
			<label kind="assignment" x="-1584" y="-448">AuthenticationFlag=af4</label>
		</transition>
		<transition>
			<source ref="id84"/>
			<target ref="id67"/>
		</transition>
		<transition>
			<source ref="id69"/>
			<target ref="id78"/>
			<label kind="assignment" x="-920" y="-320">TerminalStatus=1</label>
			<nail x="-864" y="-576"/>
		</transition>
		<transition>
			<source ref="id68"/>
			<target ref="id78"/>
			<label kind="assignment" x="-992" y="-424">TerminalStatus=0</label>
		</transition>
		<transition>
			<source ref="id70"/>
			<target ref="id68"/>
			<label kind="guard" x="-1072" y="-328">AuthenticationFlag==0</label>
		</transition>
		<transition>
			<source ref="id70"/>
			<target ref="id69"/>
			<label kind="guard" x="-1040" y="-264">AuthenticationFlag==1</label>
		</transition>
		<transition>
			<source ref="id72"/>
			<target ref="id70"/>
			<label kind="select" x="-1208" y="-280">af3:int[0,1]</label>
			<label kind="assignment" x="-1248" y="-264">AuthenticationFlag=af3</label>
		</transition>
		<transition>
			<source ref="id71"/>
			<target ref="id72"/>
			<label kind="guard" x="-1344" y="-328">AuthenticationFlag==1</label>
		</transition>
		<transition>
			<source ref="id73"/>
			<target ref="id78"/>
			<label kind="assignment" x="-1128" y="-424">TerminalStatus=0</label>
		</transition>
		<transition>
			<source ref="id71"/>
			<target ref="id73"/>
			<label kind="guard" x="-1248" y="-360">AuthenticationFlag==0</label>
		</transition>
		<transition>
			<source ref="id83"/>
			<target ref="id76"/>
			<label kind="select" x="-1416" y="-568">af1:int[0,1]</label>
			<label kind="assignment" x="-1456" y="-552">AuthenticationFlag=af1</label>
		</transition>
		<transition>
			<source ref="id75"/>
			<target ref="id71"/>
			<label kind="select" x="-1316" y="-436">af2:int[0,1]</label>
			<label kind="assignment" x="-1360" y="-424">AuthenticationFlag=af2</label>
		</transition>
		<transition>
			<source ref="id76"/>
			<target ref="id75"/>
			<label kind="guard" x="-1344" y="-520">AuthenticationFlag==1</label>
		</transition>
		<transition>
			<source ref="id74"/>
			<target ref="id78"/>
			<label kind="assignment" x="-1104" y="-608">TerminalStatus=0</label>
		</transition>
		<transition>
			<source ref="id76"/>
			<target ref="id74"/>
			<label kind="guard" x="-1248" y="-552">AuthenticationFlag==0</label>
		</transition>
		<transition>
			<source ref="id86"/>
			<target ref="id83"/>
		</transition>
		<transition>
			<source ref="id78"/>
			<target ref="id82"/>
			<label kind="synchronisation" x="-1856" y="-848">FinishAC!</label>
			<nail x="-864" y="-656"/>
			<nail x="-864" y="-848"/>
			<nail x="-1864" y="-848"/>
		</transition>
		<transition>
			<source ref="id77"/>
			<target ref="id78"/>
			<label kind="assignment" x="-1152" y="-784">GatewayStatus=0</label>
			<nail x="-952" y="-760"/>
		</transition>
		<transition>
			<source ref="id79"/>
			<target ref="id77"/>
			<label kind="guard" x="-1320" y="-728">KeyVerificationFlag==0</label>
		</transition>
		<transition>
			<source ref="id79"/>
			<target ref="id78"/>
			<label kind="guard" x="-1192" y="-656">KeyVerificationFlag==1</label>
			<label kind="assignment" x="-1176" y="-680">GatewayStatus=1</label>
		</transition>
		<transition>
			<source ref="id80"/>
			<target ref="id79"/>
			<label kind="synchronisation" x="-1352" y="-656">FinishKMS?</label>
		</transition>
		<transition>
			<source ref="id81"/>
			<target ref="id80"/>
			<label kind="synchronisation" x="-1472" y="-656">StartKMS!</label>
		</transition>
		<transition>
			<source ref="id85"/>
			<target ref="id81"/>
			<label kind="assignment" x="-1600" y="-656">KMSType=2</label>
		</transition>
		<transition>
			<source ref="id82"/>
			<target ref="id87"/>
			<label kind="synchronisation" x="-1832" y="-568">StartAC?</label>
		</transition>
		<transition>
			<source ref="id87"/>
			<target ref="id84"/>
			<label kind="guard" x="-1784" y="-520">Category==3</label>
		</transition>
		<transition>
			<source ref="id87"/>
			<target ref="id85"/>
			<label kind="guard" x="-1728" y="-656">Category==1</label>
			<nail x="-1744" y="-656"/>
		</transition>
		<transition>
			<source ref="id87"/>
			<target ref="id86"/>
			<label kind="guard" x="-1728" y="-552">Category==2</label>
		</transition>
	</template>
	<template>
		<name>IDS</name>
		<declaration>clock z;</declaration>
		<location id="id88" x="-2248" y="-640">
			<name x="-2272" y="-672">Request</name>
			<label kind="invariant" x="-2264" y="-632">z&lt;=40</label>
		</location>
		<location id="id89" x="-2344" y="-640">
			<name x="-2354" y="-670">Init</name>
		</location>
		<location id="id90" x="-1928" y="-576">
			<name x="-1960" y="-608">Response</name>
		</location>
		<location id="id91" x="-1824" y="-640">
			<name x="-1834" y="-670">End</name>
			<committed/>
		</location>
		<location id="id92" x="-1928" y="-704">
			<name x="-1944" y="-736">Alert</name>
		</location>
		<location id="id93" x="-2032" y="-640">
			<name x="-2080" y="-672">Management</name>
		</location>
		<location id="id94" x="-2144" y="-640">
			<name x="-2168" y="-672">Analysis</name>
			<label kind="invariant" x="-2160" y="-632">z&lt;=60</label>
		</location>
		<location id="id95" x="-2456" y="-640">
			<name x="-2466" y="-670">Idle</name>
		</location>
		<init ref="id95"/>
		<transition>
			<source ref="id88"/>
			<target ref="id94"/>
			<label kind="guard" x="-2216" y="-656">z&gt;=10</label>
			<label kind="assignment" x="-2208" y="-640">z:=0</label>
		</transition>
		<transition>
			<source ref="id89"/>
			<target ref="id88"/>
			<label kind="assignment" x="-2312" y="-640">z:=0</label>
		</transition>
		<transition>
			<source ref="id95"/>
			<target ref="id89"/>
			<label kind="synchronisation" x="-2432" y="-656">StartIDS?</label>
		</transition>
		<transition>
			<source ref="id91"/>
			<target ref="id95"/>
			<label kind="synchronisation" x="-2192" y="-544">FinishIDS!</label>
			<nail x="-1824" y="-528"/>
			<nail x="-2456" y="-528"/>
		</transition>
		<transition>
			<source ref="id90"/>
			<target ref="id91"/>
			<nail x="-1912" y="-584"/>
		</transition>
		<transition>
			<source ref="id92"/>
			<target ref="id91"/>
		</transition>
		<transition>
			<source ref="id93"/>
			<target ref="id90"/>
			<label kind="guard" x="-2040" y="-576">Category==2</label>
			<nail x="-2032" y="-576"/>
		</transition>
		<transition>
			<source ref="id93"/>
			<target ref="id92"/>
			<label kind="guard" x="-2040" y="-720">Category==1</label>
			<nail x="-2032" y="-704"/>
		</transition>
		<transition>
			<source ref="id94"/>
			<target ref="id93"/>
			<label kind="guard" x="-2112" y="-656">z&gt;=20</label>
		</transition>
	</template>
	<template>
		<name>Exception</name>
		<location id="id96" x="-1072" y="-600">
			<name x="-1104" y="-632">LogRecord</name>
		</location>
		<location id="id97" x="-1200" y="-600">
			<name x="-1248" y="-632">ManualHandling</name>
		</location>
		<location id="id98" x="-760" y="-600">
			<name x="-770" y="-630">End</name>
			<committed/>
		</location>
		<location id="id99" x="-760" y="-424">
			<name x="-816" y="-456">CorrectingAlgorithm</name>
		</location>
		<location id="id100" x="-904" y="-424">
			<name x="-952" y="-456">IntegratedDetection</name>
		</location>
		<location id="id101" x="-1040" y="-424">
			<name x="-1096" y="-456">AnomalousDetection</name>
		</location>
		<location id="id102" x="-1160" y="-424">
			<name x="-1176" y="-456">Input</name>
		</location>
		<location id="id103" x="-1328" y="-600">
			<name x="-1360" y="-632">DataBlock</name>
		</location>
		<location id="id104" x="-1328" y="-424">
			<name x="-1360" y="-456">CheckEL_</name>
		</location>
		<location id="id105" x="-1440" y="-512">
			<name x="-1424" y="-520">CheckEL</name>
		</location>
		<location id="id106" x="-1608" y="-512">
			<name x="-1618" y="-542">Idle</name>
		</location>
		<init ref="id106"/>
		<transition>
			<source ref="id96"/>
			<target ref="id98"/>
		</transition>
		<transition>
			<source ref="id98"/>
			<target ref="id106"/>
			<label kind="synchronisation" x="-1592" y="-688">Return!</label>
			<nail x="-760" y="-688"/>
			<nail x="-1608" y="-688"/>
		</transition>
		<transition>
			<source ref="id97"/>
			<target ref="id96"/>
		</transition>
		<transition>
			<source ref="id103"/>
			<target ref="id97"/>
		</transition>
		<transition>
			<source ref="id99"/>
			<target ref="id98"/>
		</transition>
		<transition>
			<source ref="id100"/>
			<target ref="id99"/>
		</transition>
		<transition>
			<source ref="id104"/>
			<target ref="id106"/>
			<label kind="guard" x="-1456" y="-368">ExceptionLevel==0</label>
			<label kind="synchronisation" x="-1592" y="-368">Return!</label>
			<nail x="-1328" y="-352"/>
			<nail x="-1608" y="-352"/>
		</transition>
		<transition>
			<source ref="id101"/>
			<target ref="id100"/>
		</transition>
		<transition>
			<source ref="id102"/>
			<target ref="id101"/>
		</transition>
		<transition>
			<source ref="id104"/>
			<target ref="id102"/>
			<label kind="guard" x="-1304" y="-424">ExceptionLevel==1</label>
		</transition>
		<transition>
			<source ref="id105"/>
			<target ref="id104"/>
			<label kind="select" x="-1424" y="-448">el:int[0,1]</label>
			<label kind="guard" x="-1496" y="-480">ExceptionLevel!=2</label>
			<label kind="assignment" x="-1464" y="-424">ExceptionLevel=el</label>
			<nail x="-1440" y="-424"/>
		</transition>
		<transition>
			<source ref="id105"/>
			<target ref="id103"/>
			<label kind="guard" x="-1496" y="-576">ExceptionLevel==2</label>
			<nail x="-1440" y="-600"/>
		</transition>
		<transition>
			<source ref="id106"/>
			<target ref="id105"/>
			<label kind="synchronisation" x="-1584" y="-536">HandlingException?</label>
		</transition>
	</template>
	<template>
		<name>AESDecryption</name>
		<declaration>clock x;</declaration>
		<location id="id107" x="-224" y="-304">
			<name x="-256" y="-336">Plaintext</name>
		</location>
		<location id="id108" x="-528" y="-304">
			<name x="-568" y="-336">InShiftRows_</name>
		</location>
		<location id="id109" x="-432" y="-304">
			<name x="-464" y="-336">InSubBytes_</name>
		</location>
		<location id="id110" x="-328" y="-304">
			<name x="-368" y="-336">AddRoundKey3</name>
		</location>
		<location id="id111" x="-632" y="-304">
			<name x="-680" y="-336">InMixColumns</name>
			<label kind="invariant" x="-648" y="-296">x&lt;=2</label>
		</location>
		<location id="id112" x="-752" y="-304">
			<name x="-800" y="-336">AddRoundKey2</name>
			<label kind="invariant" x="-768" y="-296">x&lt;=4</label>
		</location>
		<location id="id113" x="-856" y="-304">
			<name x="-896" y="-336">InSubBytes</name>
			<label kind="invariant" x="-872" y="-296">x&lt;=3</label>
		</location>
		<location id="id114" x="-960" y="-304">
			<name x="-1000" y="-336">InShiftRows</name>
			<label kind="invariant" x="-976" y="-296">x&lt;=2</label>
		</location>
		<location id="id115" x="-1064" y="-304">
			<name x="-1080" y="-336">MUX</name>
			<label kind="invariant" x="-1080" y="-296">x&lt;=4</label>
		</location>
		<location id="id116" x="-1184" y="-304">
			<name x="-1224" y="-336">AddRoundKey1</name>
		</location>
		<location id="id117" x="-1312" y="-304">
			<name x="-1368" y="-336">WaitCiphertext</name>
		</location>
		<init ref="id117"/>
		<transition>
			<source ref="id111"/>
			<target ref="id115"/>
			<label kind="guard" x="-824" y="-384">x&gt;=1</label>
			<label kind="assignment" x="-904" y="-384">x:=0</label>
			<nail x="-632" y="-368"/>
			<nail x="-1064" y="-368"/>
		</transition>
		<transition>
			<source ref="id107"/>
			<target ref="id117"/>
			<label kind="synchronisation" x="-816" y="-240">DReturn!</label>
			<nail x="-224" y="-240"/>
			<nail x="-1312" y="-240"/>
		</transition>
		<transition>
			<source ref="id110"/>
			<target ref="id107"/>
		</transition>
		<transition>
			<source ref="id109"/>
			<target ref="id110"/>
		</transition>
		<transition>
			<source ref="id108"/>
			<target ref="id109"/>
		</transition>
		<transition>
			<source ref="id111"/>
			<target ref="id108"/>
			<label kind="guard" x="-608" y="-304">c&gt;=100</label>
		</transition>
		<transition>
			<source ref="id112"/>
			<target ref="id111"/>
			<label kind="guard" x="-712" y="-304">x&gt;=3</label>
			<label kind="assignment" x="-712" y="-320">x:=0</label>
		</transition>
		<transition>
			<source ref="id113"/>
			<target ref="id112"/>
			<label kind="guard" x="-824" y="-304">x&gt;=2</label>
		</transition>
		<transition>
			<source ref="id114"/>
			<target ref="id113"/>
			<label kind="guard" x="-928" y="-304">x&gt;=1</label>
		</transition>
		<transition>
			<source ref="id115"/>
			<target ref="id114"/>
			<label kind="guard" x="-1032" y="-304">x&gt;=2</label>
			<label kind="assignment" x="-1032" y="-320">x:=0</label>
		</transition>
		<transition>
			<source ref="id116"/>
			<target ref="id115"/>
			<label kind="assignment" x="-1160" y="-304">x:=0, c:=0</label>
		</transition>
		<transition>
			<source ref="id117"/>
			<target ref="id116"/>
			<label kind="synchronisation" x="-1288" y="-304">Decryption?</label>
		</transition>
	</template>
	<template>
		<name>AESEncryption</name>
		<declaration>clock x;</declaration>
		<location id="id118" x="560" y="-56">
			<name x="528" y="-88">Ciphertext</name>
		</location>
		<location id="id119" x="368" y="-56">
			<name x="328" y="-88">ShiftRows_</name>
		</location>
		<location id="id120" x="464" y="-56">
			<name x="416" y="-88">AddRoundKey3</name>
		</location>
		<location id="id121" x="272" y="-56">
			<name x="240" y="-88">SubBytes_</name>
		</location>
		<location id="id122" x="64" y="-56">
			<name x="24" y="-88">MixColumns</name>
			<label kind="invariant" x="48" y="-48">x&lt;=4</label>
		</location>
		<location id="id123" x="168" y="-56">
			<name x="120" y="-88">AddRoundKey2</name>
			<label kind="invariant" x="152" y="-48">x&lt;=2</label>
		</location>
		<location id="id124" x="-32" y="-56">
			<name x="-64" y="-88">ShiftRows</name>
			<label kind="invariant" x="-48" y="-48">x&lt;=3</label>
		</location>
		<location id="id125" x="-232" y="-56">
			<name x="-248" y="-88">MUX</name>
			<label kind="invariant" x="-248" y="-48">x&lt;=4</label>
		</location>
		<location id="id126" x="-128" y="-56">
			<name x="-160" y="-88">SubBytes</name>
			<label kind="invariant" x="-144" y="-48">x&lt;=2</label>
		</location>
		<location id="id127" x="-344" y="-56">
			<name x="-400" y="-88">AddRoundKey1</name>
		</location>
		<location id="id128" x="-472" y="-56">
			<name x="-512" y="-88">WaitPlaintext</name>
		</location>
		<init ref="id128"/>
		<transition>
			<source ref="id123"/>
			<target ref="id125"/>
			<label kind="guard" x="8" y="-136">x&gt;=1</label>
			<label kind="assignment" x="-80" y="-136">x:=0</label>
			<nail x="168" y="-120"/>
			<nail x="-232" y="-120"/>
		</transition>
		<transition>
			<source ref="id118"/>
			<target ref="id128"/>
			<label kind="synchronisation" x="-8" y="8">EReturn!</label>
			<nail x="560" y="8"/>
			<nail x="-472" y="8"/>
		</transition>
		<transition>
			<source ref="id120"/>
			<target ref="id118"/>
		</transition>
		<transition>
			<source ref="id119"/>
			<target ref="id120"/>
		</transition>
		<transition>
			<source ref="id121"/>
			<target ref="id119"/>
		</transition>
		<transition>
			<source ref="id123"/>
			<target ref="id121"/>
			<label kind="guard" x="192" y="-56">c&gt;=100</label>
		</transition>
		<transition>
			<source ref="id122"/>
			<target ref="id123"/>
			<label kind="guard" x="96" y="-56">x&gt;=3</label>
			<label kind="assignment" x="96" y="-72">x:=0</label>
		</transition>
		<transition>
			<source ref="id124"/>
			<target ref="id122"/>
			<label kind="guard" x="0" y="-56">x&gt;=2</label>
		</transition>
		<transition>
			<source ref="id126"/>
			<target ref="id124"/>
			<label kind="guard" x="-96" y="-56">x&gt;=1</label>
		</transition>
		<transition>
			<source ref="id125"/>
			<target ref="id126"/>
			<label kind="guard" x="-200" y="-56">x&gt;=2</label>
			<label kind="assignment" x="-200" y="-72">x:=0</label>
		</transition>
		<transition>
			<source ref="id127"/>
			<target ref="id125"/>
			<label kind="assignment" x="-320" y="-56">x:=0, c:=0</label>
		</transition>
		<transition>
			<source ref="id128"/>
			<target ref="id127"/>
			<label kind="synchronisation" x="-448" y="-56">Encryption?</label>
		</transition>
	</template>
	<system>// Place template instantiations here.
//Top = Top();

// List one or more processes to be composed into a system.
system Top, Middle, KMS, AC, IDS, Exception, AESDecryption, AESEncryption;</system>
</nta>
